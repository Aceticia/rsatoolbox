<!DOCTYPE html>
<!-- Generated by Cython 3.0.0a11 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: similarity.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.0.0a11</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="similarity.c">similarity.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: #!/usr/bin/env python3</pre>
<pre class='cython code score-8 '>__pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: # -*- coding: utf-8 -*-</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: # cython: profile=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: import cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: from cython.view cimport array as cvarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: from libc.math cimport log, sqrt, isnan, NAN</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: from cpython.mem cimport PyMem_Malloc, PyMem_Realloc, PyMem_Free</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: cimport scipy.linalg.cython_blas as blas</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: # import numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: # np.import_array()</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-239" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">016</span>: cpdef double [:] calc(</pre>
<pre class='cython code score-239 '>static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_1calc(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/static __Pyx_memviewslice __pyx_f_10rsatoolbox_7cengine_10similarity_calc(__Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_desc, __Pyx_memviewslice __pyx_v_cv_desc, int __pyx_v_n, int __pyx_v_method_idx, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_10rsatoolbox_7cengine_10similarity_calc *__pyx_optional_args) {__Pyx_memviewslice __pyx_v_noise = __pyx_k_;double __pyx_v_prior_lambda = ((double)1.0);double __pyx_v_prior_weight = ((double)0.1);int __pyx_v_weighting = ((int)1);int __pyx_v_crossval = ((int)0);double __pyx_v_weight;double __pyx_v_sim;__Pyx_memviewslice __pyx_v_weights = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_values = { 0, 0, { 0 }, { 0 }, { 0 } };int __pyx_v_i;int __pyx_v_j;int __pyx_v_idx;int __pyx_v_n_rdm;__Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc", 0);if (__pyx_optional_args) {if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {__pyx_v_noise = __pyx_optional_args-&gt;noise;if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {__pyx_v_prior_lambda = __pyx_optional_args-&gt;prior_lambda;if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {__pyx_v_prior_weight = __pyx_optional_args-&gt;prior_weight;if (__pyx_optional_args-&gt;__pyx_n &gt; 3) {__pyx_v_weighting = __pyx_optional_args-&gt;weighting;if (__pyx_optional_args-&gt;__pyx_n &gt; 4) {__pyx_v_crossval = __pyx_optional_args-&gt;crossval;}}}}}}/* function exit code */__pyx_L1_error:;<span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_t_2);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_5, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_13, 1);__pyx_r.data = NULL;__pyx_r.memview = NULL;<span class='pyx_c_api'>__Pyx_AddTraceback</span>("rsatoolbox.cengine.similarity.calc", __pyx_clineno, __pyx_lineno, __pyx_filename);goto __pyx_L2;__pyx_L0:;if (unlikely(!__pyx_r.memview)) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");}__pyx_L2:;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_weights, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_values, 1);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}/* Python wrapper */static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_1calc(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/static PyMethodDef __pyx_mdef_10rsatoolbox_7cengine_10similarity_1calc = {"calc", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_10rsatoolbox_7cengine_10similarity_1calc, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_1calc(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {__Pyx_memviewslice __pyx_v_data = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_desc = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_cv_desc = { 0, 0, { 0 }, { 0 }, { 0 } };int __pyx_v_n;int __pyx_v_method_idx;__Pyx_memviewslice __pyx_v_noise = { 0, 0, { 0 }, { 0 }, { 0 } };double __pyx_v_prior_lambda;double __pyx_v_prior_weight;int __pyx_v_weighting;int __pyx_v_crossval;#if !CYTHON_METH_FASTCALLCYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);#endifCYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);PyObject *__pyx_r = 0;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc (wrapper)", 0);{#if CYTHON_USE_MODULE_STATEPyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data,&amp;__pyx_n_s_desc,&amp;__pyx_n_s_cv_desc,&amp;__pyx_n_s_n,&amp;__pyx_n_s_method_idx,&amp;__pyx_n_s_noise,&amp;__pyx_n_s_prior_lambda,&amp;__pyx_n_s_prior_weight,&amp;__pyx_n_s_weighting,&amp;__pyx_n_s_crossval,0};#elsestatic PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data,&amp;__pyx_n_s_desc,&amp;__pyx_n_s_cv_desc,&amp;__pyx_n_s_n,&amp;__pyx_n_s_method_idx,&amp;__pyx_n_s_noise,&amp;__pyx_n_s_prior_lambda,&amp;__pyx_n_s_prior_weight,&amp;__pyx_n_s_weighting,&amp;__pyx_n_s_crossval,0};#endifPyObject* values[10] = {0,0,0,0,0,0,0,0,0,0};if (__pyx_kwds) {Py_ssize_t kw_args;switch (__pyx_nargs) {case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);CYTHON_FALLTHROUGH;case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);CYTHON_FALLTHROUGH;case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);CYTHON_FALLTHROUGH;case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);CYTHON_FALLTHROUGH;case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);CYTHON_FALLTHROUGH;case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);CYTHON_FALLTHROUGH;case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);CYTHON_FALLTHROUGH;case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);CYTHON_FALLTHROUGH;case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);CYTHON_FALLTHROUGH;case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);CYTHON_FALLTHROUGH;case  0: break;default: goto __pyx_L5_argtuple_error;}kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);switch (__pyx_nargs) {case  0:if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>else goto __pyx_L5_argtuple_error;CYTHON_FALLTHROUGH;case  1:if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_desc)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc", 0, 5, 10, 1); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  2:if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cv_desc)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc", 0, 5, 10, 2); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  3:if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_n)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc", 0, 5, 10, 3); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  4:if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method_idx)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc", 0, 5, 10, 4); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  5:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);if (value) { values[5] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  6:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_prior_lambda);if (value) { values[6] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  7:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_prior_weight);if (value) { values[7] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  8:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_weighting);if (value) { values[8] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  9:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_crossval);if (value) { values[9] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}}if (unlikely(kw_args &gt; 0)) {const Py_ssize_t kwd_pos_args = __pyx_nargs;if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calc") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>}} else {switch (__pyx_nargs) {case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);CYTHON_FALLTHROUGH;case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);CYTHON_FALLTHROUGH;case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);CYTHON_FALLTHROUGH;case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);CYTHON_FALLTHROUGH;case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);CYTHON_FALLTHROUGH;case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);break;default: goto __pyx_L5_argtuple_error;}}__pyx_v_data = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 17, __pyx_L3_error)</span>__pyx_v_desc = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_desc.memview)) __PYX_ERR(0, 17, __pyx_L3_error)</span>__pyx_v_cv_desc = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_cv_desc.memview)) __PYX_ERR(0, 18, __pyx_L3_error)</span>__pyx_v_n = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[3]); if (unlikely((__pyx_v_n == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L3_error)</span>__pyx_v_method_idx = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_method_idx == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L3_error)</span>if (values[5]) {__pyx_v_noise = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_noise.memview)) __PYX_ERR(0, 19, __pyx_L3_error)</span>} else {__pyx_v_noise = __pyx_k_;__PYX_INC_MEMVIEW(&amp;__pyx_v_noise, 1);}if (values[6]) {__pyx_v_prior_lambda = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_prior_lambda == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L3_error)</span>} else {__pyx_v_prior_lambda = ((double)1.0);}if (values[7]) {__pyx_v_prior_weight = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_prior_weight == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L3_error)</span>} else {__pyx_v_prior_weight = ((double)0.1);}if (values[8]) {__pyx_v_weighting = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[8]); if (unlikely((__pyx_v_weighting == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L3_error)</span>} else {__pyx_v_weighting = ((int)1);}if (values[9]) {__pyx_v_crossval = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[9]); if (unlikely((__pyx_v_crossval == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L3_error)</span>} else {__pyx_v_crossval = ((int)0);}}goto __pyx_L4_argument_unpacking_done;__pyx_L5_argtuple_error:;<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc", 0, 5, 10, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L3_error)</span>__pyx_L3_error:;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_desc, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_cv_desc, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_noise, 1);<span class='pyx_c_api'>__Pyx_AddTraceback</span>("rsatoolbox.cengine.similarity.calc", __pyx_clineno, __pyx_lineno, __pyx_filename);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return NULL;__pyx_L4_argument_unpacking_done:;__pyx_r = __pyx_pf_10rsatoolbox_7cengine_10similarity_calc(__pyx_self, __pyx_v_data, __pyx_v_desc, __pyx_v_cv_desc, __pyx_v_n, __pyx_v_method_idx, __pyx_v_noise, __pyx_v_prior_lambda, __pyx_v_prior_weight, __pyx_v_weighting, __pyx_v_crossval);int __pyx_lineno = 0;const char *__pyx_filename = NULL;int __pyx_clineno = 0;/* function exit code */__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_desc, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_cv_desc, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_noise, 1);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}static PyObject *__pyx_pf_10rsatoolbox_7cengine_10similarity_calc(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_desc, __Pyx_memviewslice __pyx_v_cv_desc, int __pyx_v_n, int __pyx_v_method_idx, __Pyx_memviewslice __pyx_v_noise, double __pyx_v_prior_lambda, double __pyx_v_prior_weight, int __pyx_v_weighting, int __pyx_v_crossval) {PyObject *__pyx_r = NULL;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc", 0);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);if (unlikely(!__pyx_v_data.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("data"); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_desc.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("desc"); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_cv_desc.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("cv_desc"); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_noise.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("noise"); <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span> }__pyx_t_2.__pyx_n = 5;__pyx_t_2.noise = __pyx_v_noise;__pyx_t_2.prior_lambda = __pyx_v_prior_lambda;__pyx_t_2.prior_weight = __pyx_v_prior_weight;__pyx_t_2.weighting = __pyx_v_weighting;__pyx_t_2.crossval = __pyx_v_crossval;__pyx_t_1 = __pyx_f_10rsatoolbox_7cengine_10similarity_calc(__pyx_v_data, __pyx_v_desc, __pyx_v_cv_desc, __pyx_v_n, __pyx_v_method_idx, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 16, __pyx_L1_error)</span>__pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_1, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_1, 1);__pyx_t_1.memview = NULL; __pyx_t_1.data = NULL;__pyx_r = __pyx_t_3;__pyx_t_3 = 0;goto __pyx_L0;/* function exit code */__pyx_L1_error:;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_1, 1);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);<span class='pyx_c_api'>__Pyx_AddTraceback</span>("rsatoolbox.cengine.similarity.calc", __pyx_clineno, __pyx_lineno, __pyx_filename);__pyx_r = NULL;__pyx_L0:;<span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}__pyx_tuple__19 = <span class='py_c_api'>PyTuple_Pack</span>(10, __pyx_n_s_data, __pyx_n_s_desc, __pyx_n_s_cv_desc, __pyx_n_s_n, __pyx_n_s_method_idx, __pyx_n_s_noise, __pyx_n_s_prior_lambda, __pyx_n_s_prior_weight, __pyx_n_s_weighting, __pyx_n_s_crossval);<span class='error_goto'> if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 16, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__19);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__19);__pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 16, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_1_0);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_1_0);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_float_1_0);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_1);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_1);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_float_0_1);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, __pyx_int_1);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 4, __pyx_int_0);__pyx_t_3 = 0;__pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_10rsatoolbox_7cengine_10similarity_1calc, 0, __pyx_n_s_calc, NULL, __pyx_n_s_rsatoolbox_cengine_similarity, __pyx_d, ((PyObject *)__pyx_codeobj__20));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);<span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_3, __pyx_t_4);<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_calc, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;__pyx_codeobj__20 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(10, 0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__19, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rsatoolbox_cengine_similarit, __pyx_n_s_calc, 16, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__20)) __PYX_ERR(0, 16, __pyx_L1_error)</span>struct __pyx_opt_args_10rsatoolbox_7cengine_10similarity_calc {int __pyx_n;__Pyx_memviewslice noise;double prior_lambda;double prior_weight;int weighting;int crossval;};</pre><pre class="cython line score-0">&#xA0;<span class="">017</span>:     double [:, :] data, long [:] desc,</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>:     long [:] cv_desc, int n,</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>:     int method_idx, double [:, :] noise=None,</pre>
<pre class='cython code score-4 '>__pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)</span>__pyx_k_ = __pyx_t_2;__pyx_t_2.memview = NULL;__pyx_t_2.data = NULL;__pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)</span>__pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_2, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_2, 1);__pyx_t_2.memview = NULL; __pyx_t_2.data = NULL;</pre><pre class="cython line score-0">&#xA0;<span class="">020</span>:     double prior_lambda=1, double prior_weight=0.1,</pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>:     int weighting=1, int crossval=0):</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>:     # calculates an RDM from a double array of data with integer descriptors</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>:     # There are no checks or saveguards in this function!</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>:     # All entries in desc should be in [0, n-1]. They will be used for indexing</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>:     # into the RDM running into segfaults if they are outside the range.</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>:     # Inputs:</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>:     # double [:, :] data : the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>:     # long [:] desc : defines the patterns</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>:     # long [:] cv_desc : rows with equal values are excluded from the computation</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>:     # int n : defines the RDM size, all desc should be &lt; n</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>:     # int method_idx: which method to use:</pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>:     #     1: method == 'euclidean'</pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>:     #     2: method == 'correlation'</pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>:     #     3: method in ['mahalanobis', 'crossnobis']</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>:     #     4: method in ['poisson', 'poisson_cv']</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>:     # double [:, :] noise = None: noise for Mahalanobis/Crossnobis</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>:     # double prior_lambda=1 : for poisson KL</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>:     # double prior_weight=0.1 : for poisson KL</pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>:     # int weighting=1 : controls weighting of rows:</pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>:     #     0: each row has equal weight</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>:     #     1: rows weighted by number of valid measurements</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>:         double [:] vec_i</pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>:         double [:] vec_j</pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>:         double weight, sim</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>:         double [:] weights</pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>:         double [:] values</pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>:         int i, j, idx</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>:         int n_rdm = (n * (n-1)) / 2</pre>
<pre class='cython code score-0 '>__pyx_v_n_rdm = ((__pyx_v_n * (__pyx_v_n - 1)) / 2);</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">050</span>:     weights = &lt;double [:(n_rdm+n)]&gt; PyMem_Malloc((n_rdm+n) * sizeof(double))</pre>
<pre class='cython code score-16 '>__pyx_t_1 = <span class='py_c_api'>PyMem_Malloc</span>(((__pyx_v_n_rdm + __pyx_v_n) * (sizeof(double))));if (!__pyx_t_1) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");<span class='error_goto'>__PYX_ERR(0, 50, __pyx_L1_error)</span>}__pyx_t_4 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 50, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);__pyx_t_3 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_v_n_rdm + __pyx_v_n)));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__pyx_t_2 = __pyx_array_new(__pyx_t_3, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_4), (char *) "c", (char *) __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_2);<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;__pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_2), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 50, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_2); __pyx_t_2 = 0;__pyx_v_weights = __pyx_t_5;__pyx_t_5.memview = NULL;__pyx_t_5.data = NULL;</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">051</span>:     values = &lt;double [:(n_rdm+n)]&gt; PyMem_Malloc((n_rdm+n) * sizeof(double))</pre>
<pre class='cython code score-16 '>__pyx_t_1 = <span class='py_c_api'>PyMem_Malloc</span>(((__pyx_v_n_rdm + __pyx_v_n) * (sizeof(double))));if (!__pyx_t_1) {<span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");<span class='error_goto'>__PYX_ERR(0, 51, __pyx_L1_error)</span>}__pyx_t_3 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 51, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__pyx_t_4 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_v_n_rdm + __pyx_v_n)));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 51, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);__pyx_t_2 = __pyx_array_new(__pyx_t_4, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_3), (char *) "c", (char *) __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_2);<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;__pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_2), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 51, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_2); __pyx_t_2 = 0;__pyx_v_values = __pyx_t_5;__pyx_t_5.memview = NULL;__pyx_t_5.data = NULL;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>:     for idx in range(n_rdm + n):</pre>
<pre class='cython code score-0 '>__pyx_t_6 = (__pyx_v_n_rdm + __pyx_v_n);__pyx_t_7 = __pyx_t_6;for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {__pyx_v_idx = __pyx_t_8;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">053</span>:         weights[idx] = 0</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_weights.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_9 * __pyx_v_weights.strides[0]) )) = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">054</span>:         values[idx] = 0</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_values.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_9 * __pyx_v_values.strides[0]) )) = 0.0;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">055</span>:     for i in range(data.shape[0]):</pre>
<pre class='cython code score-0 '>__pyx_t_10 = (__pyx_v_data.shape[0]);__pyx_t_11 = __pyx_t_10;for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_11; __pyx_t_6+=1) {__pyx_v_i = __pyx_t_6;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>:         if not crossval:</pre>
<pre class='cython code score-0 '>__pyx_t_12 = (!(__pyx_v_crossval != 0));if (__pyx_t_12) {}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">057</span>:             sim, weight = similarity(</pre>
<pre class='cython code score-0 '>__pyx_t_15.__pyx_n = 3;__pyx_t_15.noise = __pyx_v_noise;__pyx_t_15.prior_lambda = __pyx_v_prior_lambda;__pyx_t_15.prior_weight = __pyx_v_prior_weight;__pyx_t_14 = __pyx_f_10rsatoolbox_7cengine_10similarity_similarity(__pyx_t_5, __pyx_t_13, __pyx_v_method_idx, 0, &amp;__pyx_t_15); __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_5, 1);__pyx_t_5.memview = NULL; __pyx_t_5.data = NULL;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_13, 1);__pyx_t_13.memview = NULL; __pyx_t_13.data = NULL;__pyx_t_16 = __pyx_t_14.f0;__pyx_t_17 = __pyx_t_14.f1;__pyx_v_sim = __pyx_t_16;__pyx_v_weight = __pyx_t_17;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">058</span>:                 data[i], data[i],</pre>
<pre class='cython code score-0 '>__pyx_t_5.data = __pyx_v_data.data;__pyx_t_5.memview = __pyx_v_data.memview;__PYX_INC_MEMVIEW(&amp;__pyx_t_5, 1);{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_data.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_data.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_5.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_5.shape[0] = __pyx_v_data.shape[1];
__pyx_t_5.strides[0] = __pyx_v_data.strides[1];
    __pyx_t_5.suboffsets[0] = -1;

__pyx_t_13.data = __pyx_v_data.data;__pyx_t_13.memview = __pyx_v_data.memview;__PYX_INC_MEMVIEW(&amp;__pyx_t_13, 1);{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_data.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_data.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_13.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_13.shape[0] = __pyx_v_data.shape[1];
__pyx_t_13.strides[0] = __pyx_v_data.strides[1];
    __pyx_t_13.suboffsets[0] = -1;

</pre><pre class="cython line score-0">&#xA0;<span class="">059</span>:                 method_idx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>:                 noise=noise,</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>:                 prior_lambda=prior_lambda,</pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:                 prior_weight=prior_weight)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>:             idx = desc[i]</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_i;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_desc.shape[0];__pyx_v_idx = (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_9 * __pyx_v_desc.strides[0]) )));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>:             if weighting == 1: #'number':</pre>
<pre class='cython code score-0 '>switch (__pyx_v_weighting) {case 1:break;case 0:</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">065</span>:                 values[idx] += sim / 2.0</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_values.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_9 * __pyx_v_values.strides[0]) )) += (__pyx_v_sim / 2.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">066</span>:                 weights[idx] += weight / 2.0</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_weights.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_9 * __pyx_v_weights.strides[0]) )) += (__pyx_v_weight / 2.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">067</span>:             elif weighting == 0: #'equal':</pre>
<pre class='cython code score-0 '>break;default: break;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">068</span>:                 values[idx] += sim / weight / 2.0</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_values.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_9 * __pyx_v_values.strides[0]) )) += ((__pyx_v_sim / __pyx_v_weight) / 2.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">069</span>:                 weights[idx] += 1 / 2.0</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_weights.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_9 * __pyx_v_weights.strides[0]) )) += (1.0 / 2.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>:         for j in range(i + 1, data.shape[0]):</pre>
<pre class='cython code score-0 '>__pyx_t_18 = (__pyx_v_data.shape[0]);__pyx_t_19 = __pyx_t_18;for (__pyx_t_7 = (__pyx_v_i + 1); __pyx_t_7 &lt; __pyx_t_19; __pyx_t_7+=1) {__pyx_v_j = __pyx_t_7;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">071</span>:             if not crossval or not cv_desc[i] == cv_desc[j]:</pre>
<pre class='cython code score-0 '>__pyx_t_20 = (!(__pyx_v_crossval != 0));if (!__pyx_t_20) {} else {__pyx_t_12 = __pyx_t_20;goto __pyx_L11_bool_binop_done;}__pyx_t_9 = __pyx_v_i;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_cv_desc.shape[0];__pyx_t_21 = __pyx_v_j;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_cv_desc.shape[0];__pyx_t_20 = (!((*((long *) ( /* dim=0 */ (__pyx_v_cv_desc.data + __pyx_t_9 * __pyx_v_cv_desc.strides[0]) ))) == (*((long *) ( /* dim=0 */ (__pyx_v_cv_desc.data + __pyx_t_21 * __pyx_v_cv_desc.strides[0]) )))));__pyx_t_12 = __pyx_t_20;__pyx_L11_bool_binop_done:;if (__pyx_t_12) {}}}</pre><pre class="cython line score-0">&#xA0;<span class="">072</span>:                 #vec_i = data[i]</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:                 #vec_j = data[j]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">074</span>:                 sim, weight = similarity(</pre>
<pre class='cython code score-0 '>__pyx_t_15.__pyx_n = 3;__pyx_t_15.noise = __pyx_v_noise;__pyx_t_15.prior_lambda = __pyx_v_prior_lambda;__pyx_t_15.prior_weight = __pyx_v_prior_weight;__pyx_t_14 = __pyx_f_10rsatoolbox_7cengine_10similarity_similarity(__pyx_t_13, __pyx_t_5, __pyx_v_method_idx, 0, &amp;__pyx_t_15); __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_13, 1);__pyx_t_13.memview = NULL; __pyx_t_13.data = NULL;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_5, 1);__pyx_t_5.memview = NULL; __pyx_t_5.data = NULL;__pyx_t_17 = __pyx_t_14.f0;__pyx_t_16 = __pyx_t_14.f1;__pyx_v_sim = __pyx_t_17;__pyx_v_weight = __pyx_t_16;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">075</span>:                     data[i], data[j],</pre>
<pre class='cython code score-0 '>__pyx_t_13.data = __pyx_v_data.data;__pyx_t_13.memview = __pyx_v_data.memview;__PYX_INC_MEMVIEW(&amp;__pyx_t_13, 1);{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_data.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_data.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_13.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_13.shape[0] = __pyx_v_data.shape[1];
__pyx_t_13.strides[0] = __pyx_v_data.strides[1];
    __pyx_t_13.suboffsets[0] = -1;

__pyx_t_5.data = __pyx_v_data.data;__pyx_t_5.memview = __pyx_v_data.memview;__PYX_INC_MEMVIEW(&amp;__pyx_t_5, 1);{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_j;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_data.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_data.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_5.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_5.shape[0] = __pyx_v_data.shape[1];
__pyx_t_5.strides[0] = __pyx_v_data.strides[1];
    __pyx_t_5.suboffsets[0] = -1;

</pre><pre class="cython line score-0">&#xA0;<span class="">076</span>:                     method_idx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:                     noise=noise,</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:                     prior_lambda=prior_lambda,</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:                     prior_weight=prior_weight)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>:                 if weight &gt; 0:</pre>
<pre class='cython code score-0 '>__pyx_t_12 = (__pyx_v_weight &gt; 0.0);if (__pyx_t_12) {}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">081</span>:                     if desc[i] == desc[j]:</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_i;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_desc.shape[0];__pyx_t_9 = __pyx_v_j;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_desc.shape[0];__pyx_t_12 = ((*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_21 * __pyx_v_desc.strides[0]) ))) == (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_9 * __pyx_v_desc.strides[0]) ))));if (__pyx_t_12) {goto __pyx_L14;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>:                         idx = desc[i]</pre>
<pre class='cython code score-0 '>__pyx_t_9 = __pyx_v_i;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_desc.shape[0];__pyx_v_idx = (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_9 * __pyx_v_desc.strides[0]) )));</pre><pre class="cython line score-0">&#xA0;<span class="">083</span>:                     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">084</span>:                         if desc[j] &gt; desc[i]:</pre>
<pre class='cython code score-0 '>/*else*/ {__pyx_t_9 = __pyx_v_j;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_desc.shape[0];__pyx_t_21 = __pyx_v_i;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_desc.shape[0];__pyx_t_12 = ((*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_9 * __pyx_v_desc.strides[0]) ))) &gt; (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_21 * __pyx_v_desc.strides[0]) ))));if (__pyx_t_12) {goto __pyx_L15;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>:                             idx = (n - 1) * desc[i] - (((desc[i] + 1) * desc[i]) / 2) + desc[j] - 1 + n</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_i;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_desc.shape[0];__pyx_t_9 = __pyx_v_i;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_desc.shape[0];__pyx_t_22 = __pyx_v_i;if (__pyx_t_22 &lt; 0) __pyx_t_22 += __pyx_v_desc.shape[0];__pyx_t_23 = __pyx_v_j;if (__pyx_t_23 &lt; 0) __pyx_t_23 += __pyx_v_desc.shape[0];__pyx_v_idx = ((((((__pyx_v_n - 1) * (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_21 * __pyx_v_desc.strides[0]) )))) - ((((*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_9 * __pyx_v_desc.strides[0]) ))) + 1) * (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_22 * __pyx_v_desc.strides[0]) )))) / 2)) + (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_23 * __pyx_v_desc.strides[0]) )))) - 1) + __pyx_v_n);</pre><pre class="cython line score-0">&#xA0;<span class="">086</span>:                         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>:                             idx = (n - 1) * desc[j] - (((desc[j] + 1) * desc[j]) / 2) + desc[i] - 1 + n</pre>
<pre class='cython code score-0 '>/*else*/ {__pyx_t_23 = __pyx_v_j;if (__pyx_t_23 &lt; 0) __pyx_t_23 += __pyx_v_desc.shape[0];__pyx_t_22 = __pyx_v_j;if (__pyx_t_22 &lt; 0) __pyx_t_22 += __pyx_v_desc.shape[0];__pyx_t_9 = __pyx_v_j;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_desc.shape[0];__pyx_t_21 = __pyx_v_i;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_desc.shape[0];__pyx_v_idx = ((((((__pyx_v_n - 1) * (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_23 * __pyx_v_desc.strides[0]) )))) - ((((*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_22 * __pyx_v_desc.strides[0]) ))) + 1) * (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_9 * __pyx_v_desc.strides[0]) )))) / 2)) + (*((long *) ( /* dim=0 */ (__pyx_v_desc.data + __pyx_t_21 * __pyx_v_desc.strides[0]) )))) - 1) + __pyx_v_n);}__pyx_L15:;}__pyx_L14:;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:                     if weighting == 1: #'number':</pre>
<pre class='cython code score-0 '>switch (__pyx_v_weighting) {case 1:break;case 0:</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:                         values[idx] += sim</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_idx;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_values.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_21 * __pyx_v_values.strides[0]) )) += __pyx_v_sim;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>:                         weights[idx] += weight</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_idx;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_weights.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_21 * __pyx_v_weights.strides[0]) )) += __pyx_v_weight;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:                     elif weighting == 0: #'equal':</pre>
<pre class='cython code score-0 '>break;default: break;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:                         values[idx] += sim / weight</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_idx;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_values.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_21 * __pyx_v_values.strides[0]) )) += (__pyx_v_sim / __pyx_v_weight);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:                         weights[idx] += 1</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_idx;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_weights.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_21 * __pyx_v_weights.strides[0]) )) += 1.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:     for idx in range(n_rdm + n):</pre>
<pre class='cython code score-0 '>__pyx_t_6 = (__pyx_v_n_rdm + __pyx_v_n);__pyx_t_7 = __pyx_t_6;for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {__pyx_v_idx = __pyx_t_8;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:         if weights[idx] &gt; 0:</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_idx;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_weights.shape[0];__pyx_t_12 = ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_21 * __pyx_v_weights.strides[0]) ))) &gt; 0.0);if (__pyx_t_12) {goto __pyx_L18;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:             values[idx] = values[idx] / weights[idx]</pre>
<pre class='cython code score-0 '>__pyx_t_21 = __pyx_v_idx;if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_values.shape[0];__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_weights.shape[0];__pyx_t_22 = __pyx_v_idx;if (__pyx_t_22 &lt; 0) __pyx_t_22 += __pyx_v_values.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_22 * __pyx_v_values.strides[0]) )) = ((*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_21 * __pyx_v_values.strides[0]) ))) / (*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_9 * __pyx_v_weights.strides[0]) ))));</pre><pre class="cython line score-0">&#xA0;<span class="">097</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:             values[idx] = NAN</pre>
<pre class='cython code score-0 '>/*else*/ {__pyx_t_9 = __pyx_v_idx;if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_values.shape[0];*((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_9 * __pyx_v_values.strides[0]) )) = NAN;}__pyx_L18:;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:     return values</pre>
<pre class='cython code score-0 '>__PYX_INC_MEMVIEW(&amp;__pyx_v_values, 1);__pyx_r = __pyx_v_values;goto __pyx_L0;</pre><pre class="cython line score-0">&#xA0;<span class="">100</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-248" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>: cpdef (double, double) calc_one(</pre>
<pre class='cython code score-248 '>static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_3calc_one(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/static __pyx_ctuple_double__and_double __pyx_f_10rsatoolbox_7cengine_10similarity_calc_one(__Pyx_memviewslice __pyx_v_data_i, __Pyx_memviewslice __pyx_v_data_j, __Pyx_memviewslice __pyx_v_cv_desc_i, __Pyx_memviewslice __pyx_v_cv_desc_j, int __pyx_v_n_i, int __pyx_v_n_j, int __pyx_v_method_idx, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_10rsatoolbox_7cengine_10similarity_calc_one *__pyx_optional_args) {__Pyx_memviewslice __pyx_v_noise = __pyx_k__2;double __pyx_v_prior_lambda = ((double)1.0);double __pyx_v_prior_weight = ((double)0.1);int __pyx_v_weighting = ((int)1);__Pyx_memviewslice __pyx_v_vec_i = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_vec_j = { 0, 0, { 0 }, { 0 }, { 0 } };double __pyx_v_weight;double __pyx_v_sim;double __pyx_v_weight_sum;double __pyx_v_value;int __pyx_v_i;int __pyx_v_j;__pyx_ctuple_double__and_double __pyx_r;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc_one", 0);if (__pyx_optional_args) {if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {__pyx_v_noise = __pyx_optional_args-&gt;noise;if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {__pyx_v_prior_lambda = __pyx_optional_args-&gt;prior_lambda;if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {__pyx_v_prior_weight = __pyx_optional_args-&gt;prior_weight;if (__pyx_optional_args-&gt;__pyx_n &gt; 3) {__pyx_v_weighting = __pyx_optional_args-&gt;weighting;}}}}}/* function exit code */__pyx_L0:;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_i, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_j, 1);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}/* Python wrapper */static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_3calc_one(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/static PyMethodDef __pyx_mdef_10rsatoolbox_7cengine_10similarity_3calc_one = {"calc_one", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_10rsatoolbox_7cengine_10similarity_3calc_one, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_3calc_one(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {__Pyx_memviewslice __pyx_v_data_i = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_data_j = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_cv_desc_i = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_cv_desc_j = { 0, 0, { 0 }, { 0 }, { 0 } };int __pyx_v_n_i;int __pyx_v_n_j;int __pyx_v_method_idx;__Pyx_memviewslice __pyx_v_noise = { 0, 0, { 0 }, { 0 }, { 0 } };double __pyx_v_prior_lambda;double __pyx_v_prior_weight;int __pyx_v_weighting;#if !CYTHON_METH_FASTCALLCYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);#endifCYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);PyObject *__pyx_r = 0;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc_one (wrapper)", 0);{#if CYTHON_USE_MODULE_STATEPyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data_i,&amp;__pyx_n_s_data_j,&amp;__pyx_n_s_cv_desc_i,&amp;__pyx_n_s_cv_desc_j,&amp;__pyx_n_s_n_i,&amp;__pyx_n_s_n_j,&amp;__pyx_n_s_method_idx,&amp;__pyx_n_s_noise,&amp;__pyx_n_s_prior_lambda,&amp;__pyx_n_s_prior_weight,&amp;__pyx_n_s_weighting,0};#elsestatic PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data_i,&amp;__pyx_n_s_data_j,&amp;__pyx_n_s_cv_desc_i,&amp;__pyx_n_s_cv_desc_j,&amp;__pyx_n_s_n_i,&amp;__pyx_n_s_n_j,&amp;__pyx_n_s_method_idx,&amp;__pyx_n_s_noise,&amp;__pyx_n_s_prior_lambda,&amp;__pyx_n_s_prior_weight,&amp;__pyx_n_s_weighting,0};#endifPyObject* values[11] = {0,0,0,0,0,0,0,0,0,0,0};if (__pyx_kwds) {Py_ssize_t kw_args;switch (__pyx_nargs) {case 11: values[10] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 10);CYTHON_FALLTHROUGH;case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);CYTHON_FALLTHROUGH;case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);CYTHON_FALLTHROUGH;case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);CYTHON_FALLTHROUGH;case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);CYTHON_FALLTHROUGH;case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);CYTHON_FALLTHROUGH;case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);CYTHON_FALLTHROUGH;case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);CYTHON_FALLTHROUGH;case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);CYTHON_FALLTHROUGH;case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);CYTHON_FALLTHROUGH;case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);CYTHON_FALLTHROUGH;case  0: break;default: goto __pyx_L5_argtuple_error;}kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);switch (__pyx_nargs) {case  0:if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data_i)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>else goto __pyx_L5_argtuple_error;CYTHON_FALLTHROUGH;case  1:if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data_j)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_one", 0, 7, 11, 1); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  2:if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cv_desc_i)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_one", 0, 7, 11, 2); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  3:if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cv_desc_j)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_one", 0, 7, 11, 3); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  4:if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_n_i)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_one", 0, 7, 11, 4); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  5:if (likely((values[5] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_n_j)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_one", 0, 7, 11, 5); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  6:if (likely((values[6] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method_idx)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_one", 0, 7, 11, 6); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  7:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);if (value) { values[7] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  8:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_prior_lambda);if (value) { values[8] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  9:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_prior_weight);if (value) { values[9] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case 10:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_weighting);if (value) { values[10] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}}if (unlikely(kw_args &gt; 0)) {const Py_ssize_t kwd_pos_args = __pyx_nargs;if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calc_one") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>}} else {switch (__pyx_nargs) {case 11: values[10] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 10);CYTHON_FALLTHROUGH;case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);CYTHON_FALLTHROUGH;case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);CYTHON_FALLTHROUGH;case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);CYTHON_FALLTHROUGH;case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);break;default: goto __pyx_L5_argtuple_error;}}__pyx_v_data_i = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_data_i.memview)) __PYX_ERR(0, 105, __pyx_L3_error)</span>__pyx_v_data_j = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_data_j.memview)) __PYX_ERR(0, 105, __pyx_L3_error)</span>__pyx_v_cv_desc_i = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_cv_desc_i.memview)) __PYX_ERR(0, 106, __pyx_L3_error)</span>__pyx_v_cv_desc_j = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_cv_desc_j.memview)) __PYX_ERR(0, 106, __pyx_L3_error)</span>__pyx_v_n_i = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_n_i == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L3_error)</span>__pyx_v_n_j = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_n_j == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L3_error)</span>__pyx_v_method_idx = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[6]); if (unlikely((__pyx_v_method_idx == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L3_error)</span>if (values[7]) {__pyx_v_noise = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_noise.memview)) __PYX_ERR(0, 108, __pyx_L3_error)</span>} else {__pyx_v_noise = __pyx_k__2;__PYX_INC_MEMVIEW(&amp;__pyx_v_noise, 1);}if (values[8]) {__pyx_v_prior_lambda = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_prior_lambda == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L3_error)</span>} else {__pyx_v_prior_lambda = ((double)1.0);}if (values[9]) {__pyx_v_prior_weight = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_prior_weight == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L3_error)</span>} else {__pyx_v_prior_weight = ((double)0.1);}if (values[10]) {__pyx_v_weighting = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[10]); if (unlikely((__pyx_v_weighting == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L3_error)</span>} else {__pyx_v_weighting = ((int)1);}}goto __pyx_L4_argument_unpacking_done;__pyx_L5_argtuple_error:;<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("calc_one", 0, 7, 11, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L3_error)</span>__pyx_L3_error:;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data_i, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data_j, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_cv_desc_i, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_cv_desc_j, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_noise, 1);<span class='pyx_c_api'>__Pyx_AddTraceback</span>("rsatoolbox.cengine.similarity.calc_one", __pyx_clineno, __pyx_lineno, __pyx_filename);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return NULL;__pyx_L4_argument_unpacking_done:;__pyx_r = __pyx_pf_10rsatoolbox_7cengine_10similarity_2calc_one(__pyx_self, __pyx_v_data_i, __pyx_v_data_j, __pyx_v_cv_desc_i, __pyx_v_cv_desc_j, __pyx_v_n_i, __pyx_v_n_j, __pyx_v_method_idx, __pyx_v_noise, __pyx_v_prior_lambda, __pyx_v_prior_weight, __pyx_v_weighting);int __pyx_lineno = 0;const char *__pyx_filename = NULL;int __pyx_clineno = 0;/* function exit code */__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data_i, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data_j, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_cv_desc_i, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_cv_desc_j, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_noise, 1);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}static PyObject *__pyx_pf_10rsatoolbox_7cengine_10similarity_2calc_one(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_data_i, __Pyx_memviewslice __pyx_v_data_j, __Pyx_memviewslice __pyx_v_cv_desc_i, __Pyx_memviewslice __pyx_v_cv_desc_j, int __pyx_v_n_i, int __pyx_v_n_j, int __pyx_v_method_idx, __Pyx_memviewslice __pyx_v_noise, double __pyx_v_prior_lambda, double __pyx_v_prior_weight, int __pyx_v_weighting) {PyObject *__pyx_r = NULL;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("calc_one", 0);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);if (unlikely(!__pyx_v_data_i.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("data_i"); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_data_j.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("data_j"); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_cv_desc_i.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("cv_desc_i"); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_cv_desc_j.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("cv_desc_j"); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_noise.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("noise"); <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span> }__pyx_t_2.__pyx_n = 4;__pyx_t_2.noise = __pyx_v_noise;__pyx_t_2.prior_lambda = __pyx_v_prior_lambda;__pyx_t_2.prior_weight = __pyx_v_prior_weight;__pyx_t_2.weighting = __pyx_v_weighting;__pyx_t_1 = __pyx_f_10rsatoolbox_7cengine_10similarity_calc_one(__pyx_v_data_i, __pyx_v_data_j, __pyx_v_cv_desc_i, __pyx_v_cv_desc_j, __pyx_v_n_i, __pyx_v_n_j, __pyx_v_method_idx, 0, &amp;__pyx_t_2); __pyx_t_3 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 104, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__pyx_r = __pyx_t_3;__pyx_t_3 = 0;goto __pyx_L0;/* function exit code */__pyx_L1_error:;<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);<span class='pyx_c_api'>__Pyx_AddTraceback</span>("rsatoolbox.cengine.similarity.calc_one", __pyx_clineno, __pyx_lineno, __pyx_filename);__pyx_r = NULL;__pyx_L0:;<span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}__pyx_tuple__21 = <span class='py_c_api'>PyTuple_Pack</span>(11, __pyx_n_s_data_i, __pyx_n_s_data_j, __pyx_n_s_cv_desc_i, __pyx_n_s_cv_desc_j, __pyx_n_s_n_i, __pyx_n_s_n_j, __pyx_n_s_method_idx, __pyx_n_s_noise, __pyx_n_s_prior_lambda, __pyx_n_s_prior_weight, __pyx_n_s_weighting);<span class='error_goto'> if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 104, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__21);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__21);__pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 104, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_1_0);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_1_0);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_float_1_0);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_1);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_1);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_float_0_1);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 3, __pyx_int_1);__pyx_t_3 = 0;__pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_10rsatoolbox_7cengine_10similarity_3calc_one, 0, __pyx_n_s_calc_one, NULL, __pyx_n_s_rsatoolbox_cengine_similarity, __pyx_d, ((PyObject *)__pyx_codeobj__22));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 104, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);<span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_3, __pyx_t_4);<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_calc_one, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;__pyx_codeobj__22 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(11, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__21, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rsatoolbox_cengine_similarit, __pyx_n_s_calc_one, 104, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__22)) __PYX_ERR(0, 104, __pyx_L1_error)</span>struct __pyx_ctuple_double__and_double {double f0;double f1;};struct __pyx_opt_args_10rsatoolbox_7cengine_10similarity_calc_one {int __pyx_n;__Pyx_memviewslice noise;double prior_lambda;double prior_weight;int weighting;};</pre><pre class="cython line score-0">&#xA0;<span class="">105</span>:     double [:, :] data_i, double [:, :] data_j,</pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>:     long [:] cv_desc_i, long [:] cv_desc_j,</pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>:     int n_i, int n_j,</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">108</span>:     int method_idx, double [:, :] noise=None,</pre>
<pre class='cython code score-4 '>__pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)</span>__pyx_k__2 = __pyx_t_2;__pyx_t_2.memview = NULL;__pyx_t_2.data = NULL;__pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)</span>__pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_2, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_2, 1);__pyx_t_2.memview = NULL; __pyx_t_2.data = NULL;</pre><pre class="cython line score-0">&#xA0;<span class="">109</span>:     double prior_lambda=1, double prior_weight=0.1,</pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>:     int weighting=1):</pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>:         #double [:] values = np.zeros(n_i * n_j)</pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:         #double [:] weights = np.zeros(n_i * n_j)</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>:         double [:] vec_i</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:         double [:] vec_j</pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:         double weight, sim, weight_sum, value</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:         int i, j</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">118</span>:     for i in range(n_i):</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_v_n_i;__pyx_t_2 = __pyx_t_1;for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {__pyx_v_i = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">119</span>:         for j in range(n_j):</pre>
<pre class='cython code score-0 '>__pyx_t_4 = __pyx_v_n_j;__pyx_t_5 = __pyx_t_4;for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {__pyx_v_j = __pyx_t_6;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">120</span>:             if not cv_desc_i[i] == cv_desc_j[j]:</pre>
<pre class='cython code score-0 '>__pyx_t_7 = __pyx_v_i;if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_cv_desc_i.shape[0];__pyx_t_8 = __pyx_v_j;if (__pyx_t_8 &lt; 0) __pyx_t_8 += __pyx_v_cv_desc_j.shape[0];__pyx_t_9 = (!((*((long *) ( /* dim=0 */ (__pyx_v_cv_desc_i.data + __pyx_t_7 * __pyx_v_cv_desc_i.strides[0]) ))) == (*((long *) ( /* dim=0 */ (__pyx_v_cv_desc_j.data + __pyx_t_8 * __pyx_v_cv_desc_j.strides[0]) )))));if (__pyx_t_9) {}}}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>:                 vec_i = data_i[i]</pre>
<pre class='cython code score-0 '>__pyx_t_10.data = __pyx_v_data_i.data;__pyx_t_10.memview = __pyx_v_data_i.memview;__PYX_INC_MEMVIEW(&amp;__pyx_t_10, 1);{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_data_i.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_data_i.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_10.shape[0] = __pyx_v_data_i.shape[1];
__pyx_t_10.strides[0] = __pyx_v_data_i.strides[1];
    __pyx_t_10.suboffsets[0] = -1;

__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_i, 1);__pyx_v_vec_i = __pyx_t_10;__pyx_t_10.memview = NULL;__pyx_t_10.data = NULL;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">122</span>:                 vec_j = data_j[j]</pre>
<pre class='cython code score-0 '>__pyx_t_10.data = __pyx_v_data_j.data;__pyx_t_10.memview = __pyx_v_data_j.memview;__PYX_INC_MEMVIEW(&amp;__pyx_t_10, 1);{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_j;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_data_j.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_data_j.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_10.shape[0] = __pyx_v_data_j.shape[1];
__pyx_t_10.strides[0] = __pyx_v_data_j.strides[1];
    __pyx_t_10.suboffsets[0] = -1;

__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_j, 1);__pyx_v_vec_j = __pyx_t_10;__pyx_t_10.memview = NULL;__pyx_t_10.data = NULL;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">123</span>:                 sim, weight = similarity(</pre>
<pre class='cython code score-0 '>__pyx_t_12.__pyx_n = 3;__pyx_t_12.noise = __pyx_v_noise;__pyx_t_12.prior_lambda = __pyx_v_prior_lambda;__pyx_t_12.prior_weight = __pyx_v_prior_weight;__pyx_t_11 = __pyx_f_10rsatoolbox_7cengine_10similarity_similarity(__pyx_v_vec_i, __pyx_v_vec_j, __pyx_v_method_idx, 0, &amp;__pyx_t_12); __pyx_t_13 = __pyx_t_11.f0;__pyx_t_14 = __pyx_t_11.f1;__pyx_v_sim = __pyx_t_13;__pyx_v_weight = __pyx_t_14;</pre><pre class="cython line score-0">&#xA0;<span class="">124</span>:                     vec_i, vec_j,</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:                     method_idx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:                     noise=noise,</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>:                     prior_lambda=prior_lambda,</pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:                     prior_weight=prior_weight)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">129</span>:                 if weight &gt; 0:</pre>
<pre class='cython code score-0 '>__pyx_t_9 = (__pyx_v_weight &gt; 0.0);if (__pyx_t_9) {}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">130</span>:                     if weighting == 1: #'number':</pre>
<pre class='cython code score-0 '>switch (__pyx_v_weighting) {case 1:break;case 0:</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>:                         value += sim</pre>
<pre class='cython code score-0 '>__pyx_v_value = (__pyx_v_value + __pyx_v_sim);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>:                         weight_sum += weight</pre>
<pre class='cython code score-0 '>__pyx_v_weight_sum = (__pyx_v_weight_sum + __pyx_v_weight);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>:                     elif weighting == 0: #'equal':</pre>
<pre class='cython code score-0 '>break;default: break;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:                         value += sim / weight</pre>
<pre class='cython code score-0 '>__pyx_v_value = (__pyx_v_value + (__pyx_v_sim / __pyx_v_weight));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">135</span>:                         weight_sum += 1</pre>
<pre class='cython code score-0 '>__pyx_v_weight_sum = (__pyx_v_weight_sum + 1.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">136</span>:     if weight_sum &gt; 0:</pre>
<pre class='cython code score-0 '>__pyx_t_9 = (__pyx_v_weight_sum &gt; 0.0);if (__pyx_t_9) {goto __pyx_L9;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:         value = value / weight_sum</pre>
<pre class='cython code score-0 '>__pyx_v_value = (__pyx_v_value / __pyx_v_weight_sum);</pre><pre class="cython line score-0">&#xA0;<span class="">138</span>:     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:         value = NAN</pre>
<pre class='cython code score-0 '>/*else*/ {__pyx_v_value = NAN;}__pyx_L9:;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:     return value, weight_sum</pre>
<pre class='cython code score-0 '>__pyx_t_11.f0 = __pyx_v_value;__pyx_t_11.f1 = __pyx_v_weight_sum;__pyx_r = __pyx_t_11;goto __pyx_L0;</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-158" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>: cpdef (double, double) similarity(double [:] vec_i, double [:] vec_j, int method_idx,</pre>
<pre class='cython code score-158 '>static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_5similarity(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/static __pyx_ctuple_double__and_double __pyx_f_10rsatoolbox_7cengine_10similarity_similarity(__Pyx_memviewslice __pyx_v_vec_i, __Pyx_memviewslice __pyx_v_vec_j, int __pyx_v_method_idx, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_10rsatoolbox_7cengine_10similarity_similarity *__pyx_optional_args) {__Pyx_memviewslice __pyx_v_noise = __pyx_k__3;double __pyx_v_prior_lambda = ((double)1.0);double __pyx_v_prior_weight = ((double)0.1);double __pyx_v_sim;double __pyx_v_weight;int __pyx_v_n_dim;__pyx_ctuple_double__and_double __pyx_r;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("similarity", 0);if (__pyx_optional_args) {if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {__pyx_v_noise = __pyx_optional_args-&gt;noise;if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {__pyx_v_prior_lambda = __pyx_optional_args-&gt;prior_lambda;if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {__pyx_v_prior_weight = __pyx_optional_args-&gt;prior_weight;}}}}/* function exit code */__pyx_L1_error:;<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);<span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("rsatoolbox.cengine.similarity.similarity", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);__Pyx_pretend_to_initialize(&amp;__pyx_r);__pyx_L0:;<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}/* Python wrapper */static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_5similarity(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_10rsatoolbox_7cengine_10similarity_4similarity, "\n    double similarity(double [:] vec_i, double [:] vec_j, int method_idx,\n                      double [:, :] noise=None,\n                      double prior_lambda=1, double prior_weight=0.1)\n\n    This is a single similarity computation in cython.\n    remember to call everything with continuous numpy arrays.\n    In particular, noise must be such an array for Mahalanobis distances!\n\n    Mahalanobis distances require full measurement vectors at the moment!\n    ");static PyMethodDef __pyx_mdef_10rsatoolbox_7cengine_10similarity_5similarity = {"similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_10rsatoolbox_7cengine_10similarity_5similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_10rsatoolbox_7cengine_10similarity_4similarity};static PyObject *__pyx_pw_10rsatoolbox_7cengine_10similarity_5similarity(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {__Pyx_memviewslice __pyx_v_vec_i = { 0, 0, { 0 }, { 0 }, { 0 } };__Pyx_memviewslice __pyx_v_vec_j = { 0, 0, { 0 }, { 0 }, { 0 } };int __pyx_v_method_idx;__Pyx_memviewslice __pyx_v_noise = { 0, 0, { 0 }, { 0 }, { 0 } };double __pyx_v_prior_lambda;double __pyx_v_prior_weight;#if !CYTHON_METH_FASTCALLCYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);#endifCYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);PyObject *__pyx_r = 0;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("similarity (wrapper)", 0);{#if CYTHON_USE_MODULE_STATEPyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vec_i,&amp;__pyx_n_s_vec_j,&amp;__pyx_n_s_method_idx,&amp;__pyx_n_s_noise,&amp;__pyx_n_s_prior_lambda,&amp;__pyx_n_s_prior_weight,0};#elsestatic PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_vec_i,&amp;__pyx_n_s_vec_j,&amp;__pyx_n_s_method_idx,&amp;__pyx_n_s_noise,&amp;__pyx_n_s_prior_lambda,&amp;__pyx_n_s_prior_weight,0};#endifPyObject* values[6] = {0,0,0,0,0,0};if (__pyx_kwds) {Py_ssize_t kw_args;switch (__pyx_nargs) {case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);CYTHON_FALLTHROUGH;case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);CYTHON_FALLTHROUGH;case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);CYTHON_FALLTHROUGH;case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);CYTHON_FALLTHROUGH;case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);CYTHON_FALLTHROUGH;case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);CYTHON_FALLTHROUGH;case  0: break;default: goto __pyx_L5_argtuple_error;}kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);switch (__pyx_nargs) {case  0:if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_vec_i)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>else goto __pyx_L5_argtuple_error;CYTHON_FALLTHROUGH;case  1:if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_vec_j)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("similarity", 0, 3, 6, 1); <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  2:if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method_idx)) != 0)) kw_args--;else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>else {<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("similarity", 0, 3, 6, 2); <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  3:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);if (value) { values[3] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  4:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_prior_lambda);if (value) { values[4] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>}CYTHON_FALLTHROUGH;case  5:if (kw_args &gt; 0) {PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_prior_weight);if (value) { values[5] = value; kw_args--; }else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>}}if (unlikely(kw_args &gt; 0)) {const Py_ssize_t kwd_pos_args = __pyx_nargs;if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "similarity") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>}} else {switch (__pyx_nargs) {case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);CYTHON_FALLTHROUGH;case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);CYTHON_FALLTHROUGH;case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);CYTHON_FALLTHROUGH;case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);break;default: goto __pyx_L5_argtuple_error;}}__pyx_v_vec_i = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vec_i.memview)) __PYX_ERR(0, 144, __pyx_L3_error)</span>__pyx_v_vec_j = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vec_j.memview)) __PYX_ERR(0, 144, __pyx_L3_error)</span>__pyx_v_method_idx = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[2]); if (unlikely((__pyx_v_method_idx == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>if (values[3]) {__pyx_v_noise = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_noise.memview)) __PYX_ERR(0, 145, __pyx_L3_error)</span>} else {__pyx_v_noise = __pyx_k__3;__PYX_INC_MEMVIEW(&amp;__pyx_v_noise, 1);}if (values[4]) {__pyx_v_prior_lambda = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]); if (unlikely((__pyx_v_prior_lambda == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 146, __pyx_L3_error)</span>} else {__pyx_v_prior_lambda = ((double)1.0);}if (values[5]) {__pyx_v_prior_weight = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[5]); if (unlikely((__pyx_v_prior_weight == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 146, __pyx_L3_error)</span>} else {__pyx_v_prior_weight = ((double)0.1);}}goto __pyx_L4_argument_unpacking_done;__pyx_L5_argtuple_error:;<span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("similarity", 0, 3, 6, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L3_error)</span>__pyx_L3_error:;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_i, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_j, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_noise, 1);<span class='pyx_c_api'>__Pyx_AddTraceback</span>("rsatoolbox.cengine.similarity.similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return NULL;__pyx_L4_argument_unpacking_done:;__pyx_r = __pyx_pf_10rsatoolbox_7cengine_10similarity_4similarity(__pyx_self, __pyx_v_vec_i, __pyx_v_vec_j, __pyx_v_method_idx, __pyx_v_noise, __pyx_v_prior_lambda, __pyx_v_prior_weight);int __pyx_lineno = 0;const char *__pyx_filename = NULL;int __pyx_clineno = 0;/* function exit code */__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_i, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vec_j, 1);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_noise, 1);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}static PyObject *__pyx_pf_10rsatoolbox_7cengine_10similarity_4similarity(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_vec_i, __Pyx_memviewslice __pyx_v_vec_j, int __pyx_v_method_idx, __Pyx_memviewslice __pyx_v_noise, double __pyx_v_prior_lambda, double __pyx_v_prior_weight) {PyObject *__pyx_r = NULL;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("similarity", 0);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);if (unlikely(!__pyx_v_vec_i.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("vec_i"); <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_vec_j.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("vec_j"); <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span> }if (unlikely(!__pyx_v_noise.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("noise"); <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span> }__pyx_t_2.__pyx_n = 3;__pyx_t_2.noise = __pyx_v_noise;__pyx_t_2.prior_lambda = __pyx_v_prior_lambda;__pyx_t_2.prior_weight = __pyx_v_prior_weight;__pyx_t_1 = __pyx_f_10rsatoolbox_7cengine_10similarity_similarity(__pyx_v_vec_i, __pyx_v_vec_j, __pyx_v_method_idx, 0, &amp;__pyx_t_2); __pyx_t_3 = <span class='pyx_c_api'>__pyx_convert__to_py___pyx_ctuple_double__and_double</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 144, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__pyx_r = __pyx_t_3;__pyx_t_3 = 0;goto __pyx_L0;/* function exit code */__pyx_L1_error:;<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);<span class='pyx_c_api'>__Pyx_AddTraceback</span>("rsatoolbox.cengine.similarity.similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);__pyx_r = NULL;__pyx_L0:;<span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}__pyx_tuple__23 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_vec_i, __pyx_n_s_vec_j, __pyx_n_s_method_idx, __pyx_n_s_noise, __pyx_n_s_prior_lambda, __pyx_n_s_prior_weight);<span class='error_goto'> if (unlikely(!__pyx_tuple__23)) __PYX_ERR(0, 144, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__23);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__23);__pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_1_0);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_1_0);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_float_1_0);<span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_float_0_1);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_float_0_1);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_float_0_1);__pyx_t_3 = 0;__pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_10rsatoolbox_7cengine_10similarity_5similarity, 0, __pyx_n_s_similarity, NULL, __pyx_n_s_rsatoolbox_cengine_similarity, __pyx_d, ((PyObject *)__pyx_codeobj__24));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 144, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);<span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_3, __pyx_t_4);<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_similarity, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;__pyx_codeobj__24 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__23, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rsatoolbox_cengine_similarit, __pyx_n_s_similarity, 144, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__24)) __PYX_ERR(0, 144, __pyx_L1_error)</span>struct __pyx_opt_args_10rsatoolbox_7cengine_10similarity_similarity {int __pyx_n;__Pyx_memviewslice noise;double prior_lambda;double prior_weight;};</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">145</span>:                        double [:, :] noise=None,</pre>
<pre class='cython code score-4 '>__pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 145, __pyx_L1_error)</span>__pyx_k__3 = __pyx_t_2;__pyx_t_2.memview = NULL;__pyx_t_2.data = NULL;__pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 145, __pyx_L1_error)</span>__pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_2, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 145, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_2, 1);__pyx_t_2.memview = NULL; __pyx_t_2.data = NULL;</pre><pre class="cython line score-0">&#xA0;<span class="">146</span>:                        double prior_lambda=1, double prior_weight=0.1):</pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:     double similarity(double [:] vec_i, double [:] vec_j, int method_idx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:                       double [:, :] noise=None,</pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:                       double prior_lambda=1, double prior_weight=0.1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:     This is a single similarity computation in cython.</pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:     remember to call everything with continuous numpy arrays.</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:     In particular, noise must be such an array for Mahalanobis distances!</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:     Mahalanobis distances require full measurement vectors at the moment!</pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>:     cdef double sim</pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:     cdef double weight</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>:     cdef int n_dim = vec_i.shape[0]</pre>
<pre class='cython code score-0 '>__pyx_v_n_dim = (__pyx_v_vec_i.shape[0]);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>:     if method_idx == 1: # method == 'euclidean':</pre>
<pre class='cython code score-0 '>switch (__pyx_v_method_idx) {case 1:break;case 2:</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">162</span>:         sim, weight = euclid(vec_i, vec_j, n_dim)</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_f_10rsatoolbox_7cengine_10similarity_euclid(__pyx_v_vec_i, __pyx_v_vec_j, __pyx_v_n_dim);__pyx_t_2 = __pyx_t_1.f0;__pyx_t_3 = __pyx_t_1.f1;__pyx_v_sim = __pyx_t_2;__pyx_v_weight = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:     elif method_idx == 2: # method == 'correlation':</pre>
<pre class='cython code score-0 '>break;case 3:</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">164</span>:         sim, weight = correlation(vec_i, vec_j, n_dim)</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_f_10rsatoolbox_7cengine_10similarity_correlation(__pyx_v_vec_i, __pyx_v_vec_j, __pyx_v_n_dim);__pyx_t_3 = __pyx_t_1.f0;__pyx_t_2 = __pyx_t_1.f1;__pyx_v_sim = __pyx_t_3;__pyx_v_weight = __pyx_t_2;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:     elif method_idx == 3: # method in ['mahalanobis', 'crossnobis']:</pre>
<pre class='cython code score-0 '>break;case 4:</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:         if noise is None:</pre>
<pre class='cython code score-0 '>__pyx_t_4 = (((PyObject *) __pyx_v_noise.memview) == Py_None);if (__pyx_t_4) {goto __pyx_L3;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:             sim, weight = similarity(vec_i, vec_j, 1)</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_f_10rsatoolbox_7cengine_10similarity_similarity(__pyx_v_vec_i, __pyx_v_vec_j, 1, 0, NULL);__pyx_t_2 = __pyx_t_1.f0;__pyx_t_3 = __pyx_t_1.f1;__pyx_v_sim = __pyx_t_2;__pyx_v_weight = __pyx_t_3;</pre><pre class="cython line score-0">&#xA0;<span class="">168</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:             sim = mahalanobis(vec_i, vec_j, n_dim, noise)</pre>
<pre class='cython code score-0 '>/*else*/ {__pyx_v_sim = __pyx_f_10rsatoolbox_7cengine_10similarity_mahalanobis(__pyx_v_vec_i, __pyx_v_vec_j, __pyx_v_n_dim, __pyx_v_noise);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:             weight = &lt;double&gt; n_dim</pre>
<pre class='cython code score-0 '>__pyx_v_weight = ((double)__pyx_v_n_dim);}__pyx_L3:;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>:     elif method_idx == 4: # method in ['poisson', 'poisson_cv']:</pre>
<pre class='cython code score-0 '>break;default:</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:         sim, weight = poisson_cv(vec_i, vec_j, n_dim, prior_lambda, prior_weight)</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_f_10rsatoolbox_7cengine_10similarity_poisson_cv(__pyx_v_vec_i, __pyx_v_vec_j, __pyx_v_n_dim, __pyx_v_prior_lambda, __pyx_v_prior_weight);__pyx_t_3 = __pyx_t_1.f0;__pyx_t_2 = __pyx_t_1.f1;__pyx_v_sim = __pyx_t_3;__pyx_v_weight = __pyx_t_2;</pre><pre class="cython line score-0">&#xA0;<span class="">173</span>:     else:</pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">174</span>:         raise ValueError('dissimilarity method not recognized!')</pre>
<pre class='cython code score-10 '>__pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 174, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);<span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;<span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>break;}__pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_dissimilarity_method_not_recogni);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 174, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">175</span>:     return sim, weight</pre>
<pre class='cython code score-0 '>__pyx_t_1.f0 = __pyx_v_sim;__pyx_t_1.f1 = __pyx_v_weight;__pyx_r = __pyx_t_1;goto __pyx_L0;</pre><pre class="cython line score-0">&#xA0;<span class="">176</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">179</span>: cdef (double, double) euclid(double [:] vec_i, double [:] vec_j, int n_dim):</pre>
<pre class='cython code score-0 '>static __pyx_ctuple_double__and_double __pyx_f_10rsatoolbox_7cengine_10similarity_euclid(__Pyx_memviewslice __pyx_v_vec_i, __Pyx_memviewslice __pyx_v_vec_j, int __pyx_v_n_dim) {double __pyx_v_sim;double __pyx_v_weight;int __pyx_v_i;__pyx_ctuple_double__and_double __pyx_r;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("euclid", 0);/* function exit code */__pyx_L0:;<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}</pre><pre class="cython line score-0">&#xA0;<span class="">180</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">181</span>:         double sim = 0</pre>
<pre class='cython code score-0 '>__pyx_v_sim = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>:         double weight = 0</pre>
<pre class='cython code score-0 '>__pyx_v_weight = 0.0;</pre><pre class="cython line score-0">&#xA0;<span class="">183</span>:         int i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:     for i in range(n_dim):</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_v_n_dim;__pyx_t_2 = __pyx_t_1;for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {__pyx_v_i = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>:         if not isnan(vec_i[i]) and not isnan(vec_j[i]):</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) )))));if (__pyx_t_6) {} else {__pyx_t_4 = __pyx_t_6;goto __pyx_L6_bool_binop_done;}__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) )))));__pyx_t_4 = __pyx_t_6;__pyx_L6_bool_binop_done:;if (__pyx_t_4) {}}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>:             sim += vec_i[i] * vec_j[i]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_t_7 = __pyx_v_i;if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_vec_j.shape[0];__pyx_v_sim = (__pyx_v_sim + ((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_7 * __pyx_v_vec_j.strides[0]) )))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>:             weight += 1</pre>
<pre class='cython code score-0 '>__pyx_v_weight = (__pyx_v_weight + 1.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>:     return sim, weight</pre>
<pre class='cython code score-0 '>__pyx_t_8.f0 = __pyx_v_sim;__pyx_t_8.f1 = __pyx_v_weight;__pyx_r = __pyx_t_8;goto __pyx_L0;</pre><pre class="cython line score-0">&#xA0;<span class="">189</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">191</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">192</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>: cdef (double, double) poisson_cv(double [:] vec_i, double [:] vec_j, int n_dim,</pre>
<pre class='cython code score-0 '>static __pyx_ctuple_double__and_double __pyx_f_10rsatoolbox_7cengine_10similarity_poisson_cv(__Pyx_memviewslice __pyx_v_vec_i, __Pyx_memviewslice __pyx_v_vec_j, int __pyx_v_n_dim, double __pyx_v_prior_lambda, double __pyx_v_prior_weight) {double __pyx_v_prior_lambda_l;double __pyx_v_prior_weight_l;double __pyx_v_vi;double __pyx_v_vj;double __pyx_v_sim;double __pyx_v_weight;int __pyx_v_i;__pyx_ctuple_double__and_double __pyx_r;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("poisson_cv", 0);/* function exit code */__pyx_L0:;<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}</pre><pre class="cython line score-0">&#xA0;<span class="">195</span>:                        double prior_lambda, double prior_weight):</pre>
<pre class="cython line score-0">&#xA0;<span class="">196</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:         double prior_lambda_l = prior_lambda * prior_weight</pre>
<pre class='cython code score-0 '>__pyx_v_prior_lambda_l = (__pyx_v_prior_lambda * __pyx_v_prior_weight);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:         double prior_weight_l = 1 + prior_weight</pre>
<pre class='cython code score-0 '>__pyx_v_prior_weight_l = (1.0 + __pyx_v_prior_weight);</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>:         double vi, vj</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:         double sim = 0</pre>
<pre class='cython code score-0 '>__pyx_v_sim = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:         double weight = 0</pre>
<pre class='cython code score-0 '>__pyx_v_weight = 0.0;</pre><pre class="cython line score-0">&#xA0;<span class="">202</span>:         int i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:     for i in range(n_dim):</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_v_n_dim;__pyx_t_2 = __pyx_t_1;for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {__pyx_v_i = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:         if not isnan(vec_i[i]) and not isnan(vec_j[i]):</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) )))));if (__pyx_t_6) {} else {__pyx_t_4 = __pyx_t_6;goto __pyx_L6_bool_binop_done;}__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) )))));__pyx_t_4 = __pyx_t_6;__pyx_L6_bool_binop_done:;if (__pyx_t_4) {}}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:             vi = (vec_i[i] + prior_lambda_l) / prior_weight_l</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_v_vi = (((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) ))) + __pyx_v_prior_lambda_l) / __pyx_v_prior_weight_l);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">206</span>:             vj = (vec_j[i] + prior_lambda_l) / prior_weight_l</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];__pyx_v_vj = (((*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) ))) + __pyx_v_prior_lambda_l) / __pyx_v_prior_weight_l);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:             sim += (vj - vi) * (log(vi) - log(vj))</pre>
<pre class='cython code score-0 '>__pyx_v_sim = (__pyx_v_sim + ((__pyx_v_vj - __pyx_v_vi) * (log(__pyx_v_vi) - log(__pyx_v_vj))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>:             weight += 1</pre>
<pre class='cython code score-0 '>__pyx_v_weight = (__pyx_v_weight + 1.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:     sim = sim / 2.0</pre>
<pre class='cython code score-0 '>__pyx_v_sim = (__pyx_v_sim / 2.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>:     return (sim, weight)</pre>
<pre class='cython code score-0 '>__pyx_t_7.f0 = __pyx_v_sim;__pyx_t_7.f1 = __pyx_v_weight;__pyx_r = __pyx_t_7;goto __pyx_L0;</pre><pre class="cython line score-0">&#xA0;<span class="">211</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>: cdef double mahalanobis(double [:] vec_i, double [:] vec_j, int n_dim,</pre>
<pre class='cython code score-6 '>static double __pyx_f_10rsatoolbox_7cengine_10similarity_mahalanobis(__Pyx_memviewslice __pyx_v_vec_i, __Pyx_memviewslice __pyx_v_vec_j, int __pyx_v_n_dim, __Pyx_memviewslice __pyx_v_noise) {double *__pyx_v_vec1;double *__pyx_v_vec2;int *__pyx_v_finite;CYTHON_UNUSED int __pyx_v_zero;int __pyx_v_one;double __pyx_v_onef;double __pyx_v_zerof;char __pyx_v_trans;double __pyx_v_sim;int __pyx_v_i;int __pyx_v_j;int __pyx_v_k;int __pyx_v_l;int __pyx_v_n_finite;__Pyx_memviewslice __pyx_v_noise_small = { 0, 0, { 0 }, { 0 }, { 0 } };double *__pyx_v_vec3;double __pyx_r;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("mahalanobis", 0);/* function exit code */__pyx_L1_error:;<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);<span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);__PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);<span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("rsatoolbox.cengine.similarity.mahalanobis", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);__pyx_r = 0;__pyx_L0:;__PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_noise_small, 1);<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}</pre><pre class="cython line score-0">&#xA0;<span class="">215</span>:                         double [:, :] noise):</pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>:         double *vec1</pre>
<pre class="cython line score-0">&#xA0;<span class="">218</span>:         double *vec2</pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>:         int *finite</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">220</span>:         int zero = 0</pre>
<pre class='cython code score-0 '>__pyx_v_zero = 0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">221</span>:         int one = 1</pre>
<pre class='cython code score-0 '>__pyx_v_one = 1;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:         double onef = 1.0</pre>
<pre class='cython code score-0 '>__pyx_v_onef = 1.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:         double zerof = 0.0</pre>
<pre class='cython code score-0 '>__pyx_v_zerof = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>:         char trans = b'n'</pre>
<pre class='cython code score-0 '>__pyx_v_trans = 'n';</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:         double sim = 0.0</pre>
<pre class='cython code score-0 '>__pyx_v_sim = 0.0;</pre><pre class="cython line score-0">&#xA0;<span class="">226</span>:         int i, j, k, l, n_finite</pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>:         double [:, :] noise_small</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">228</span>:     finite = &lt;int*&gt; PyMem_Malloc(n_dim * sizeof(int))</pre>
<pre class='cython code score-5 '>__pyx_v_finite = ((int *)<span class='py_c_api'>PyMem_Malloc</span>((__pyx_v_n_dim * (sizeof(int)))));</pre><pre class="cython line score-0">&#xA0;<span class="">229</span>:     # use finite as a bool to choose the non-nan values</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">230</span>:     n_finite = 0</pre>
<pre class='cython code score-0 '>__pyx_v_n_finite = 0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:     for i in range(n_dim):</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_v_n_dim;__pyx_t_2 = __pyx_t_1;for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {__pyx_v_i = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">232</span>:         if not isnan(vec_i[i]) and not isnan(vec_j[i]):</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) )))));if (__pyx_t_6) {} else {__pyx_t_4 = __pyx_t_6;goto __pyx_L6_bool_binop_done;}__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) )))));__pyx_t_4 = __pyx_t_6;__pyx_L6_bool_binop_done:;if (__pyx_t_4) {goto __pyx_L5;}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:             finite[i] = 1</pre>
<pre class='cython code score-0 '>(__pyx_v_finite[__pyx_v_i]) = 1;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:             n_finite += 1</pre>
<pre class='cython code score-0 '>__pyx_v_n_finite = (__pyx_v_n_finite + 1);</pre><pre class="cython line score-0">&#xA0;<span class="">235</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">236</span>:             finite[i] = 0</pre>
<pre class='cython code score-0 '>/*else*/ {(__pyx_v_finite[__pyx_v_i]) = 0;}__pyx_L5:;}</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:     vec1 = &lt;double*&gt; PyMem_Malloc(n_finite * sizeof(double))</pre>
<pre class='cython code score-5 '>__pyx_v_vec1 = ((double *)<span class='py_c_api'>PyMem_Malloc</span>((__pyx_v_n_finite * (sizeof(double)))));</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:     vec2 = &lt;double*&gt; PyMem_Malloc(n_finite * sizeof(double))</pre>
<pre class='cython code score-5 '>__pyx_v_vec2 = ((double *)<span class='py_c_api'>PyMem_Malloc</span>((__pyx_v_n_finite * (sizeof(double)))));</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>:     vec3 = &lt;double*&gt; PyMem_Malloc(n_finite * sizeof(double))</pre>
<pre class='cython code score-5 '>__pyx_v_vec3 = ((double *)<span class='py_c_api'>PyMem_Malloc</span>((__pyx_v_n_finite * (sizeof(double)))));</pre><pre class="cython line score-0">&#xA0;<span class="">240</span>:     #noise_small = &lt;double [:n_finite, :n_finite]&gt; PyMem_Malloc(n_finite * n_finite * sizeof(double))</pre>
<pre class="cython line score-38" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>:     noise_small = cvarray(shape=(n_finite, n_finite), itemsize=sizeof(double), format="d")</pre>
<pre class='cython code score-38 '>__pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 241, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);__pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n_finite);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 241, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);__pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n_finite);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 241, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);__pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 241, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8);<span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);<span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_t_9);__pyx_t_8 = 0;__pyx_t_9 = 0;if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_shape, __pyx_t_10) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 241, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;__pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>((sizeof(double)));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 241, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_itemsize, __pyx_t_10) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 241, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_format, __pyx_n_s_d) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 241, __pyx_L1_error)</span>__pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_array_type), __pyx_empty_tuple, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 241, __pyx_L1_error)</span><span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);<span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;__pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_10, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 241, __pyx_L1_error)</span><span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;__pyx_v_noise_small = __pyx_t_11;__pyx_t_11.memview = NULL;__pyx_t_11.data = NULL;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:     k = 0</pre>
<pre class='cython code score-0 '>__pyx_v_k = 0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:     for i in range(n_dim):</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_v_n_dim;__pyx_t_2 = __pyx_t_1;for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {__pyx_v_i = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:         if finite[i]:</pre>
<pre class='cython code score-0 '>__pyx_t_4 = ((__pyx_v_finite[__pyx_v_i]) != 0);if (__pyx_t_4) {}}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>:             vec1[k] = vec_i[i]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];(__pyx_v_vec1[__pyx_v_k]) = (*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) )));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">246</span>:             vec2[k] = vec_j[i]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];(__pyx_v_vec2[__pyx_v_k]) = (*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) )));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>:             l = 0</pre>
<pre class='cython code score-0 '>__pyx_v_l = 0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:             for j in range(n_dim):</pre>
<pre class='cython code score-0 '>__pyx_t_12 = __pyx_v_n_dim;__pyx_t_13 = __pyx_t_12;for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {__pyx_v_j = __pyx_t_14;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:                 if finite[j]:</pre>
<pre class='cython code score-0 '>__pyx_t_4 = ((__pyx_v_finite[__pyx_v_j]) != 0);if (__pyx_t_4) {}}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">250</span>:                     noise_small[k, l] = noise[i, j]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;__pyx_t_15 = __pyx_v_j;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_noise.shape[0];if (__pyx_t_15 &lt; 0) __pyx_t_15 += __pyx_v_noise.shape[1];__pyx_t_16 = __pyx_v_k;__pyx_t_17 = __pyx_v_l;if (__pyx_t_16 &lt; 0) __pyx_t_16 += __pyx_v_noise_small.shape[0];if (__pyx_t_17 &lt; 0) __pyx_t_17 += __pyx_v_noise_small.shape[1];*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_noise_small.data + __pyx_t_16 * __pyx_v_noise_small.strides[0]) ) + __pyx_t_17 * __pyx_v_noise_small.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_noise.data + __pyx_t_5 * __pyx_v_noise.strides[0]) ) + __pyx_t_15 * __pyx_v_noise.strides[1]) )));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">251</span>:                     l += 1</pre>
<pre class='cython code score-0 '>__pyx_v_l = (__pyx_v_l + 1);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">252</span>:             k += 1</pre>
<pre class='cython code score-0 '>__pyx_v_k = (__pyx_v_k + 1);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">253</span>:     blas.dgemv(&amp;trans, &amp;n_finite, &amp;n_finite, &amp;onef, &amp;noise_small[0, 0], &amp;n_finite, vec2, &amp;one, &amp;zerof, vec3, &amp;one)</pre>
<pre class='cython code score-0 '>__pyx_t_15 = 0;__pyx_t_5 = 0;if (__pyx_t_15 &lt; 0) __pyx_t_15 += __pyx_v_noise_small.shape[0];if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_noise_small.shape[1];__pyx_f_5scipy_6linalg_11cython_blas_dgemv((&amp;__pyx_v_trans), (&amp;__pyx_v_n_finite), (&amp;__pyx_v_n_finite), (&amp;__pyx_v_onef), (&amp;(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_noise_small.data + __pyx_t_15 * __pyx_v_noise_small.strides[0]) ) + __pyx_t_5 * __pyx_v_noise_small.strides[1]) )))), (&amp;__pyx_v_n_finite), __pyx_v_vec2, (&amp;__pyx_v_one), (&amp;__pyx_v_zerof), __pyx_v_vec3, (&amp;__pyx_v_one));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">254</span>:     for i in range(n_dim):</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_v_n_dim;__pyx_t_2 = __pyx_t_1;for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {__pyx_v_i = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">255</span>:         sim += vec1[i] * vec3[i]</pre>
<pre class='cython code score-0 '>__pyx_v_sim = (__pyx_v_sim + ((__pyx_v_vec1[__pyx_v_i]) * (__pyx_v_vec3[__pyx_v_i])));}</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">256</span>:     PyMem_Free(vec1)</pre>
<pre class='cython code score-5 '><span class='py_c_api'>PyMem_Free</span>(__pyx_v_vec1);</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">257</span>:     PyMem_Free(vec2)</pre>
<pre class='cython code score-5 '><span class='py_c_api'>PyMem_Free</span>(__pyx_v_vec2);</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">258</span>:     PyMem_Free(vec3)</pre>
<pre class='cython code score-5 '><span class='py_c_api'>PyMem_Free</span>(__pyx_v_vec3);</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>:     PyMem_Free(finite)</pre>
<pre class='cython code score-5 '><span class='py_c_api'>PyMem_Free</span>(__pyx_v_finite);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>:     return sim</pre>
<pre class='cython code score-0 '>__pyx_r = __pyx_v_sim;goto __pyx_L0;</pre><pre class="cython line score-0">&#xA0;<span class="">261</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">265</span>: cdef (double, double) correlation(double [:] vec_i, double [:] vec_j, int n_dim):</pre>
<pre class='cython code score-0 '>static __pyx_ctuple_double__and_double __pyx_f_10rsatoolbox_7cengine_10similarity_correlation(__Pyx_memviewslice __pyx_v_vec_i, __Pyx_memviewslice __pyx_v_vec_j, int __pyx_v_n_dim) {double __pyx_v_si;double __pyx_v_sj;double __pyx_v_si2;double __pyx_v_sj2;double __pyx_v_sij;double __pyx_v_sim;double __pyx_v_weight;int __pyx_v_i;__pyx_ctuple_double__and_double __pyx_r;<span class='refnanny'>__Pyx_RefNannyDeclarations</span><span class='refnanny'>__Pyx_RefNannySetupContext</span>("correlation", 0);/* function exit code */__pyx_L0:;<span class='refnanny'>__Pyx_RefNannyFinishContext</span>();return __pyx_r;}</pre><pre class="cython line score-0">&#xA0;<span class="">266</span>:     cdef:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">267</span>:         double si = 0.0</pre>
<pre class='cython code score-0 '>__pyx_v_si = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">268</span>:         double sj = 0.0</pre>
<pre class='cython code score-0 '>__pyx_v_sj = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">269</span>:         double si2 = 0.0</pre>
<pre class='cython code score-0 '>__pyx_v_si2 = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:         double sj2 = 0.0</pre>
<pre class='cython code score-0 '>__pyx_v_sj2 = 0.0;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">271</span>:         double sij = 0.0</pre>
<pre class='cython code score-0 '>__pyx_v_sij = 0.0;</pre><pre class="cython line score-0">&#xA0;<span class="">272</span>:         double sim</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">273</span>:         double weight = 0</pre>
<pre class='cython code score-0 '>__pyx_v_weight = 0.0;</pre><pre class="cython line score-0">&#xA0;<span class="">274</span>:         int i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">275</span>:     for i in range(n_dim):</pre>
<pre class='cython code score-0 '>__pyx_t_1 = __pyx_v_n_dim;__pyx_t_2 = __pyx_t_1;for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {__pyx_v_i = __pyx_t_3;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">276</span>:         if not isnan(vec_i[i]) and not isnan(vec_j[i]):</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) )))));if (__pyx_t_6) {} else {__pyx_t_4 = __pyx_t_6;goto __pyx_L6_bool_binop_done;}__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];__pyx_t_6 = (!isnan((*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) )))));__pyx_t_4 = __pyx_t_6;__pyx_L6_bool_binop_done:;if (__pyx_t_4) {}}</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>:             si += vec_i[i]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_v_si = (__pyx_v_si + (*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) ))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>:             sj += vec_j[i]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];__pyx_v_sj = (__pyx_v_sj + (*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) ))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:             si2 += vec_i[i] * vec_i[i]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_t_7 = __pyx_v_i;if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_vec_i.shape[0];__pyx_v_si2 = (__pyx_v_si2 + ((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_7 * __pyx_v_vec_i.strides[0]) )))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:             sj2 += vec_j[i] * vec_j[i]</pre>
<pre class='cython code score-0 '>__pyx_t_7 = __pyx_v_i;if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_vec_j.shape[0];__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_j.shape[0];__pyx_v_sj2 = (__pyx_v_sj2 + ((*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_7 * __pyx_v_vec_j.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_5 * __pyx_v_vec_j.strides[0]) )))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>:             sij += vec_i[i] * vec_j[i]</pre>
<pre class='cython code score-0 '>__pyx_t_5 = __pyx_v_i;if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_vec_i.shape[0];__pyx_t_7 = __pyx_v_i;if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_vec_j.shape[0];__pyx_v_sij = (__pyx_v_sij + ((*((double *) ( /* dim=0 */ (__pyx_v_vec_i.data + __pyx_t_5 * __pyx_v_vec_i.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_vec_j.data + __pyx_t_7 * __pyx_v_vec_j.strides[0]) )))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">282</span>:             weight += 1</pre>
<pre class='cython code score-0 '>__pyx_v_weight = (__pyx_v_weight + 1.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">283</span>:     if si2 &gt; 0 and sj2 &gt; 0:</pre>
<pre class='cython code score-0 '>__pyx_t_6 = (__pyx_v_si2 &gt; 0.0);if (__pyx_t_6) {} else {__pyx_t_4 = __pyx_t_6;goto __pyx_L9_bool_binop_done;}__pyx_t_6 = (__pyx_v_sj2 &gt; 0.0);__pyx_t_4 = __pyx_t_6;__pyx_L9_bool_binop_done:;if (__pyx_t_4) {goto __pyx_L8;}</pre><pre class="cython line score-0">&#xA0;<span class="">284</span>:         # sim = (np.sum(vec_i * vec_j) / np.sqrt(norm_i) / np.sqrt(norm_j))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>:         sim = sij - (si * sj / n_dim)</pre>
<pre class='cython code score-0 '>__pyx_v_sim = (__pyx_v_sij - ((__pyx_v_si * __pyx_v_sj) / ((double)__pyx_v_n_dim)));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:         sim /= sqrt(si2 - (si * si / n_dim))</pre>
<pre class='cython code score-0 '>__pyx_v_sim = (__pyx_v_sim / sqrt((__pyx_v_si2 - ((__pyx_v_si * __pyx_v_si) / ((double)__pyx_v_n_dim)))));</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>:         sim /= sqrt(sj2 - (sj * sj / n_dim))</pre>
<pre class='cython code score-0 '>__pyx_v_sim = (__pyx_v_sim / sqrt((__pyx_v_sj2 - ((__pyx_v_sj * __pyx_v_sj) / ((double)__pyx_v_n_dim)))));</pre><pre class="cython line score-0">&#xA0;<span class="">288</span>:     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">289</span>:         sim = 1</pre>
<pre class='cython code score-0 '>/*else*/ {__pyx_v_sim = 1.0;}__pyx_L8:;</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>:     sim = sim * n_dim / 2</pre>
<pre class='cython code score-0 '>__pyx_v_sim = ((__pyx_v_sim * __pyx_v_n_dim) / 2.0);</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">291</span>:     return sim, weight</pre>
<pre class='cython code score-0 '>__pyx_t_8.f0 = __pyx_v_sim;__pyx_t_8.f1 = __pyx_v_weight;__pyx_r = __pyx_t_8;goto __pyx_L0;</pre></div></body></html>
